<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ravnica Investigation Board</title>
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/board.css">
    <meta name="theme-color" content="#1e1e1e">
</head>

<body>
    <canvas id="vector-cloud"></canvas>

    <div id="mobile-warning" class="mobile-only-warning">
        âš ï¸ Best Experience on Desktop
    </div>

    <!-- Canvas for drawing physics strings -->
    <canvas id="connection-layer"></canvas>

    <header class="hero-header board-hero">
        <div>
            <p class="hero-eyebrow">Ravnica Task Force</p>
            <h1>Investigation Board</h1>
            <p class="hero-subtitle">A virtual whiteboard for tracking clues, NPCs, and faction threads with physics-assisted connections.</p>
            <div class="hero-meta">Case File <strong id="caseName" contenteditable="true">UNNAMED</strong></div>
        </div>
        <div class="hero-actions">
            <div class="hero-action-bar primary">
                <a class="hero-btn ghost" href="tools.html">Portal</a>
                <button class="hero-btn ghost" id="btn-pan" onclick="togglePanMode()">ğŸ–ï¸ Pan: OFF</button>
                <button class="hero-btn ghost" onclick="saveBoard()">ğŸ’¾ Save</button>
                <button class="hero-btn danger" onclick="clearBoard()">ğŸ—‘ï¸ Clear</button>
            </div>
            <div class="hero-action-bar secondary">
                <button class="hero-btn ghost" onclick="triggerAccentPicker()">ğŸ¨ Accent</button>
                <button class="hero-btn ghost" id="btn-bg-style" onclick="cycleBgStyle()">ğŸŒŒ BG: Field</button>
            </div>
            <input type="color" id="accent-picker-input"
                style="position:absolute; opacity:0; pointer-events:none;" onchange="setAccentColor(this.value)">
        </div>
    </header>

    <!-- Container for the dragged nodes -->
    <div id="board-container"></div>

    <!-- Container for string labels (separate to sit on top of canvas but below focused nodes) -->
    <div id="string-label-container"></div>

    <div id="toolbar-toggle" onclick="toggleToolbar()">Hide Toolbar</div>

    <div class="toolbar-scroll-wrapper" id="toolbar-wrapper">
        <div class="toolbar">
            <!-- CORE TOOLS -->
            <div class="tool-group">
                <div class="tool-item" draggable="true" ondragstart="startDragNew(event, 'person')">
                    <div class="icon">ğŸ‘¤</div>
                    <div class="label">Person</div>
                </div>
                <div class="tool-item" draggable="true" ondragstart="startDragNew(event, 'location')">
                    <div class="icon">ğŸ“</div>
                    <div class="label">Location</div>
                </div>
                <div class="tool-item" draggable="true" ondragstart="startDragNew(event, 'clue')">
                    <div class="icon">ğŸ”</div>
                    <div class="label">Clue</div>
                </div>
                <div class="tool-item" draggable="true" ondragstart="startDragNew(event, 'note')">
                    <div class="icon">ğŸ“</div>
                    <div class="label">Note</div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- POPUP TRIGGERS -->
            <div class="tool-group">
                <div class="tool-item" id="btn-guilds"
                    onclick="event.stopPropagation(); window.togglePopup('guild-popup')">
                    <div class="icon">ğŸ›ï¸</div>
                    <div class="label">Guilds</div>
                </div>
                <div class="tool-item" id="btn-npcs" onclick="event.stopPropagation(); window.togglePopup('npc-popup')">
                    <div class="icon">ğŸ‘¥</div>
                    <div class="label">NPCs</div>
                </div>
                <div class="tool-item" id="btn-locations"
                    onclick="event.stopPropagation(); window.togglePopup('location-popup')">
                    <div class="icon">ğŸ“</div>
                    <div class="label">Places</div>
                </div>
                <div class="tool-item" id="btn-events"
                    onclick="event.stopPropagation(); window.togglePopup('event-popup')">
                    <div class="icon">ğŸ•°ï¸</div>
                    <div class="label">Events</div>
                </div>
                <div class="tool-item" id="btn-reqs"
                    onclick="event.stopPropagation(); window.togglePopup('req-popup')">
                    <div class="icon">ğŸ“¦</div>
                    <div class="label">Reqs</div>
                </div>
            </div>
        </div>
    </div>

    <!-- POPUP MENUS -->
    <div id="popup-layer">
        <div id="guild-popup" class="popup-menu"></div>
        <div id="npc-popup" class="popup-menu"></div>
        <div id="location-popup" class="popup-menu"></div>
        <div id="event-popup" class="popup-menu"></div>
        <div id="req-popup" class="popup-menu"></div>
    </div>
    </div>
    </div>

    <!-- Context Menu (Simplified, mostly replaced by direct interaction) -->
    <div id="context-menu" class="context-menu">
        <div class="menu-item" onclick="editTargetNode()">âœï¸ Edit Text</div>
        <div class="menu-item" id="menu-set-image" onclick="setTargetNodeImageUrl()">ğŸ–¼ï¸ Set Image URL</div>
        <div class="menu-item" onclick="centerAndOptimize()">ğŸ¯ Center & Optimize</div>
        <div class="menu-item delete" onclick="deleteTargetNode()">ğŸ—‘ï¸ Delete Node</div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/data-npcs.js"></script>
    <script src="js/data-locations.js"></script>
    <script src="js/store.js"></script>
    <script src="js/session-log.js"></script>
    <script src="js/vector-field.js"></script>
    <script src="js/board.js"></script>
</body>

</html>
