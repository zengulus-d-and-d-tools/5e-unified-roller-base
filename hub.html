<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Force Hub v2</title>
    <style>
        :root {
            --bg: #121212; --card: #1e1e1e; --accent: #4ecdc4; --danger: #ff6b6b; --gold: #f1c40f; --text: #e0e0e0; --border: #333;
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 900px; display: flex; flex-direction: column; gap: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid var(--border); }
        .grid-5 { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        
        /* Player Section */
        .player-row { border-bottom: 1px solid #333; padding: 15px 0; display: grid; grid-template-columns: 1fr 2fr 1.5fr auto; gap: 15px; align-items: start; }
        .player-name { font-weight: bold; color: var(--accent); font-size: 1.1rem; }
        .dp-counter { background: #000; padding: 5px 10px; border-radius: 4px; border: 1px solid var(--gold); color: var(--gold); font-weight: bold; text-align: center; }
        
        /* Clock Visuals */
        .clock-container { display: flex; gap: 4px; margin-top: 5px; }
        .clock-seg { width: 15px; height: 15px; border: 1px solid #555; border-radius: 2px; }
        .clock-seg.filled { background: var(--accent); border-color: var(--accent); }

        /* General UI */
        .btn { background: #333; color: white; border: 1px solid #444; padding: 6px 12px; cursor: pointer; border-radius: 4px; font-size: 0.8rem; }
        .btn:hover { border-color: var(--accent); }
        .btn-dp { background: var(--gold); color: #000; font-weight: bold; border: none; }
        h2 { margin: 0 0 15px 0; color: var(--accent); text-transform: uppercase; font-size: 1rem; letter-spacing: 1px; display: flex; justify-content: space-between; align-items: center; }
        input[type="text"] { background: #111; border: 1px solid #444; color: #fff; padding: 5px; border-radius: 4px; width: 100%; }
        .mini-label { font-size: 0.65rem; text-transform: uppercase; color: #888; font-weight: bold; display: block; margin-bottom: 2px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>Global Status</h2>
        <div class="grid-5" id="repGrid"></div>
        <div style="margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                <span class="mini-label">Task Force Heat (0-6)</span>
                <span id="heatVal" style="font-weight: 900; color: var(--danger);">0</span>
            </div>
            <div id="heatMeter" style="height: 10px; background: #333; border-radius: 5px; overflow: hidden; display: flex;">
                <div id="heatFill" style="height: 100%; background: var(--danger); transition: 0.3s;"></div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Player Roster <button class="btn" onclick="addPlayer()">+ Add Player</button></h2>
        <div id="rosterList"></div>
        <div style="margin-top: 15px; text-align: center;">
            <button class="btn-dp" onclick="grantWeeklyDP()" style="padding: 10px 20px;">Grant +2 DP to All (End of Case)</button>
        </div>
    </div>

    <div class="card" style="font-size: 0.8rem; color: #aaa; background: #161616;">
        <span class="mini-label">Quick DP Reference</span>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div>• <b>Lay Low (1):</b> -1 Heat</div>
            <div>• <b>Optics (2):</b> -1 Heat & +1 Rep</div>
            <div>• <b>Favor (1):</b> Prep Access/Support</div>
            <div>• <b>Development (1):</b> 2 DP = New Tool/Lang</div>
        </div>
    </div>
</div>

<script>
    const guilds = ["Azorius", "Boros", "Dimir", "Golgari", "Gruul", "Izzet", "Orzhov", "Rakdos", "Selesnya", "Simic"];
    let state = JSON.parse(localStorage.getItem('ravnicaHubV2')) || {
        rep: { Azorius: 0, Boros: 0, Dimir: 0, Golgari: 0, Gruul: 0, Izzet: 0, Orzhov: 0, Rakdos: 0, Selesnya: 0, Simic: 0 },
        heat: 0,
        players: []
    };

    function save() {
        localStorage.setItem('ravnicaHubV2', JSON.stringify(state));
        render();
    }

    // -- SHARED STATUS --
    function modRep(g, amt) { state.rep[g] = Math.max(-2, Math.min(2, state.rep[g] + amt)); save(); }
    function modHeat(amt) { state.heat = Math.max(0, Math.min(6, state.heat + amt)); save(); }

    // -- PLAYER LOGIC --
    function addPlayer() {
        state.players.push({
            name: "New Recruit",
            dp: 2,
            devProgress: 0,
            projectClock: 0,
            projectName: "Personal Project"
        });
        save();
    }

    function modDP(idx, amt) {
        state.players[idx].dp = Math.max(0, Math.min(4, state.players[idx].dp + amt));
        save();
    }

    function grantWeeklyDP() {
        state.players.forEach(p => p.dp = Math.min(4, p.dp + 2));
        save();
    }

    function modClock(idx, type, amt) {
        if(type === 'dev') state.players[idx].devProgress = (state.players[idx].devProgress + amt) % 3;
        if(type === 'proj') state.players[idx].projectClock = Math.max(0, Math.min(4, state.players[idx].projectClock + amt));
        save();
    }

    function updateName(idx, val) { state.players[idx].name = val; save(); }

    function render() {
        // Reputation Grid
        document.getElementById('repGrid').innerHTML = guilds.map(g => `
            <div style="text-align:center; padding:5px; border:1px solid #333; border-radius:4px;">
                <div class="mini-label">${g}</div>
                <div style="font-weight:900; color:${state.rep[g]>0?'#2ecc71':state.rep[g]<0?'#ff6b6b':'#666'}">${state.rep[g]>0?'+':''}${state.rep[g]}</div>
                <div style="display:flex; justify-content:center; gap:5px; margin-top:3px;">
                    <button class="btn" onclick="modRep('${g}',-1)" style="padding:2px 6px;">-</button>
                    <button class="btn" onclick="modRep('${g}',1)" style="padding:2px 6px;">+</button>
                </div>
            </div>
        `).join('');

        // Heat
        document.getElementById('heatVal').innerText = state.heat;
        document.getElementById('heatFill').style.width = (state.heat / 6 * 100) + '%';

        // Roster
        document.getElementById('rosterList').innerHTML = state.players.map((p, i) => `
            <div class="player-row">
                <div>
                    <input type="text" value="${p.name}" onchange="updateName(${i}, this.value)">
                    <div class="dp-counter" style="margin-top:10px;">${p.dp} DP Available</div>
                    <div style="display:flex; justify-content:center; gap:5px; margin-top:5px;">
                        <button class="btn" onclick="modDP(${i},-1)">-</button>
                        <button class="btn" onclick="modDP(${i},1)">+</button>
                    </div>
                </div>
                <div>
                    <span class="mini-label">Development Progress (2/Skill)</span>
                    <div class="clock-container">
                        <div class="clock-seg ${p.devProgress>=1?'filled':''}"></div>
                        <div class="clock-seg ${p.devProgress>=2?'filled':''}"></div>
                        <button class="btn" onclick="modClock(${i},'dev',1)" style="margin-left:10px; padding:2px 8px;">Advance</button>
                    </div>
                    <span class="mini-label" style="margin-top:10px;">Active Project Clock (4 Segments)</span>
                    <div class="clock-container">
                        ${[1,2,3,4].map(s => `<div class="clock-seg ${p.projectClock>=s?'filled':''}"></div>`).join('')}
                        <button class="btn" onclick="modClock(${i},'proj',1)" style="margin-left:10px; padding:2px 8px;">+</button>
                        <button class="btn" onclick="modClock(${i},'proj',-1)" style="padding:2px 8px;">-</button>
                    </div>
                </div>
                <div style="font-size:0.75rem; color:#888;">
                    <b>Unit Management:</b><br>
                    - If Heat >= 3: Complication Scene<br>
                    - If Heat = 6: Hard Constraint
                </div>
                <button class="btn" style="color:var(--danger);" onclick="state.players.splice(${i},1); save();">&times;</button>
            </div>
        `).join('');
    }

    render();
</script>
</body>
</html>
