<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravnica DM Portal</title>
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/tools.css">
    <link rel="stylesheet" href="css/tools-page.css">
</head>

<body>
    <canvas id="vector-cloud"></canvas>

    <div class="tools-container">
        <header class="hero-header">
            <div>
                <p class="hero-eyebrow">Ravnica Task Force</p>
                <h1 class="header-title" id="pageTitle" data-onclick="trySecretToggle(event)">Tools Hub</h1>
                <p class="hero-subtitle">Central dispatch for character sheets, command dashboards, and scenario generators.</p>
            </div>
            <div class="hero-actions">
                <div class="hero-action-bar primary">
                    <button class="hero-btn ghost" data-onclick="handleImport()">üì• Import</button>
                    <button class="hero-btn ghost" data-onclick="handleExport()">üì§ Export</button>
                </div>
                <div class="hero-action-bar secondary">
                    <button class="hero-btn ghost" data-onclick="triggerAccentPicker()">üé® Accent</button>
                    <button class="hero-btn ghost" id="btn-bg-style" data-onclick="cycleBgStyle()">üåå BG: Field</button>
                </div>
                <input type="color" id="accent-picker-input"
                    class="tools-accent-picker-input" data-onchange="setAccentColor(this.value)">
            </div>
        </header>

        <section class="case-switcher card" id="case-switcher" aria-label="Case Switcher">
            <div class="case-switcher-head">
                <h2 class="sync-title">Active Case Context</h2>
                <div class="case-switcher-meta" id="case-switcher-meta">Waiting for store...</div>
            </div>
            <p class="sync-desc">
                Board and Timeline are scoped to the selected case. NPC, location, requisition, and roster data remain shared across all cases.
            </p>
            <div class="case-switcher-row">
                <select id="active-case-select" data-onchange="selectActiveCase(this.value)" aria-label="Select Active Case"></select>
                <button class="sync-btn" id="case-rename-btn" data-onclick="renameActiveCase()">Rename</button>
                <button class="sync-btn" id="case-delete-btn" data-onclick="deleteActiveCase()">Delete</button>
            </div>
            <div class="case-switcher-row">
                <input id="new-case-name" type="text" placeholder="New case name">
                <button class="sync-btn primary" id="case-create-btn" data-onclick="createCaseFromInput()">Create + Switch</button>
            </div>
            <div id="case-switcher-status" class="case-switcher-status">Case tools initializing...</div>
        </section>

        <section class="sync-panel card tools-hidden" id="sync-panel" aria-label="Cloud Sync">
            <h2 class="sync-title">Cloud Sync (Supabase)</h2>
            <p class="sync-desc">
                Realtime sync for campaign tools (Hub, Board, Roster, Timeline, etc). Character sheets stay local per browser by default.
            </p>
            <div class="sync-grid">
                <div class="sync-field">
                    <label for="sync-url">Project URL</label>
                    <input id="sync-url" type="text" placeholder="https://YOUR_PROJECT.supabase.co">
                </div>
                <div class="sync-field">
                    <label for="sync-key">Anon Key</label>
                    <input id="sync-key" type="password" placeholder="eyJhbGciOi...">
                </div>
                <div class="sync-field">
                    <label for="sync-campaign">Campaign ID</label>
                    <input id="sync-campaign" type="text" placeholder="ravnica-main">
                </div>
                <div class="sync-field">
                    <label for="sync-profile">Profile Name (Optional)</label>
                    <input id="sync-profile" type="text" placeholder="DM Console">
                </div>
            </div>
            <div class="sync-actions">
                <button class="sync-btn" data-onclick="saveSyncConfig()">Save Config</button>
                <button class="sync-btn primary" data-onclick="connectSync()">Connect</button>
                <button class="sync-btn" data-onclick="disconnectSync()">Disconnect</button>
                <button class="sync-btn" data-onclick="pullSyncNow()">Pull Latest</button>
                <button class="sync-btn" data-onclick="pushSyncNow()">Push Now</button>
                <button class="sync-btn" data-onclick="anonymousSignIn()">Anonymous Sign-In</button>
                <button class="sync-btn" data-onclick="signOutSync()">Sign Out</button>
                <button class="sync-btn" data-onclick="exportConnectFile()">Export connect.json</button>
            </div>
            <div id="sync-conflict-box" class="sync-conflict tools-hidden">
                <div class="sync-conflict-head">Sync Conflict Detected</div>
                <div id="sync-conflict-detail" class="sync-conflict-detail">Remote changes overlap local edits.</div>
                <div class="sync-conflict-actions">
                    <button class="sync-btn" data-onclick="acceptRemoteConflict()">Accept Remote</button>
                    <button class="sync-btn primary" data-onclick="keepLocalConflict()">Keep Local + Merge Push</button>
                </div>
            </div>
            <div id="sync-status" class="sync-status">Cloud sync status: waiting for store...</div>
        </section>

        <section class="sync-panel customize-panel card tools-hidden" id="customize-panel" aria-label="Customise Seed Data">
            <h2 class="sync-title">Customise Seed Data (Fork Tool)</h2>
            <p class="sync-desc">
                Build fork-ready preload files from JSON. Download `data-guilds*.js`, `data-npcs*.js`, and `data-locations*.js` to seed fresh installs fast.
            </p>
            <div class="sync-grid">
                <div class="sync-field">
                    <label for="customize-label">File Label (Optional)</label>
                    <input id="customize-label" type="text" placeholder="myfork">
                </div>
            </div>
            <div class="customize-actions">
                <button class="sync-btn" data-onclick="loadCustomizeDefaults()">Load Current Defaults</button>
                <button class="sync-btn" data-onclick="loadCustomizeFromCampaign()">Load From Campaign Store</button>
                <button class="sync-btn" data-onclick="downloadCustomDataFile('guilds')">Download data-guilds.js</button>
                <button class="sync-btn" data-onclick="downloadCustomDataFile('npcs')">Download data-npcs.js</button>
                <button class="sync-btn" data-onclick="downloadCustomDataFile('locations')">Download data-locations.js</button>
                <button class="sync-btn primary" data-onclick="downloadCustomDataFiles()">Download All</button>
            </div>
            <div class="sync-grid">
                <div class="sync-field">
                    <label for="customize-guilds-json">Guild/Faction Seed JSON</label>
                    <textarea id="customize-guilds-json" spellcheck="false"
                        placeholder='["Faction Alpha","Faction Beta","Free Agents"]'></textarea>
                </div>
                <div class="sync-field">
                    <label for="customize-npcs-json">NPC Seed JSON</label>
                    <textarea id="customize-npcs-json" spellcheck="false"
                        placeholder='[{"name":"Captain Mira Kord","guild":"Boros Legion","wants":"Results","leverage":"Acts first","notes":"Precinct Commander"}]'></textarea>
                </div>
                <div class="sync-field">
                    <label for="customize-locations-json">Location Seed JSON</label>
                    <textarea id="customize-locations-json" spellcheck="false"
                        placeholder='[{"name":"Sunhome","district":"Boros Legion","desc":"Fortress and barracks","notes":"Heavy security"}]'></textarea>
                </div>
            </div>
            <p class="customize-hint"><code>name</code> is required for NPC/location records. Guild entries can be plain strings or objects with <code>name</code>.</p>
            <div id="customize-status" class="customize-status">Ready. Load defaults or campaign data to start.</div>
        </section>

        <section class="sync-quick card" id="sync-quick" aria-label="Quick Cloud Connect">
            <div class="sync-quick-head">
                <h2 class="sync-quick-title">Cloud Connect</h2>
            </div>
            <p class="sync-quick-note">
                Players: import a DM-provided <code>connect.json</code> and you should be online in a few seconds.
            </p>
            <div class="sync-quick-actions">
                <button class="sync-btn primary" data-onclick="importConnectFile()">Import connect.json</button>
                <button class="sync-btn" data-onclick="useBundledConnect()">Use bundled connect.json</button>
            </div>
            <div id="sync-quick-status" class="sync-quick-status">Status: waiting for sync engine...</div>
        </section>

        <div class="grid">
            <a href="index.html">
                <div class="card tools-card-accent">
                    <div class="icon">üßô‚Äç‚ôÇÔ∏è</div>
                    <div class="title">My Character</div>
                    <div class="desc">Character sheet, dice roller, and stats.</div>
                </div>
            </a>

            <a href="player-dashboard.html">
                <div class="card">
                    <div class="icon">‚ôüÔ∏è</div>
                    <div class="title">Player Dashboard</div>
                    <div class="desc">At-a-glance player stats.</div>
                </div>
            </a>

            <a href="requisitions.html">
                <div class="card">
                    <div class="icon">üì¶</div>
                    <div class="title">Requisition Vault</div>
                    <div class="desc">Shared kit requests, priorities, and approvals.</div>
                </div>
            </a>

            <a href="timeline.html">
                <div class="card">
                    <div class="icon">üï∞Ô∏è</div>
                    <div class="title">Mission Timeline</div>
                    <div class="desc">Session beats, fallout notes, and debriefs.</div>
                </div>
            </a>

            <a href="hq.html">
                <div class="card">
                    <div class="icon">üèõÔ∏è</div>
                    <div class="title">HQ Layout Foundry</div>
                    <div class="desc">Blueprint floors, downtime slots, and rapid-deploy resource bays.</div>
                </div>
            </a>

            <a href="hub.html" class="dm-only">
                <div class="card">
                    <div class="icon">üèòÔ∏è</div>
                    <div class="title">Main Hub</div>
                    <div class="desc">Campaign state, reputation tracking, and roster.</div>
                </div>
            </a>

            <a href="roster.html">
                <div class="card">
                    <div class="icon">üë•</div>
                    <div class="title">NPC Roster</div>
                    <div class="desc">Database of contacts, rivals, and guild members.</div>
                </div>
            </a>

            <a href="tourney.html">
                <div class="card">
                    <div class="icon">üèÜ</div>
                    <div class="title">Tournament Bracket</div>
                    <div class="desc">Dynamic SVG bracket for competitions and duals.</div>
                </div>
            </a>

            <a href="board.html">
                <div class="card">
                    <div class="icon">üï∏Ô∏è</div>
                    <div class="title">Investigation Board</div>
                    <div class="desc">Visual node-graph for connecting Clues, NPCs, and Locations.</div>
                </div>
            </a>

            <a href="locations.html">
                <div class="card">
                    <div class="icon">üìç</div>
                    <div class="title">Locations</div>
                    <div class="desc">Database of key locations and districts.</div>
                </div>
            </a>

            <!-- DM ONLY TOOLS -->
            <a href="gm.html" class="dm-only">
                <div class="card tools-card-danger">
                    <div class="icon">‚öîÔ∏è</div>
                    <div class="title">Combat Dashboard</div>
                    <div class="desc">Initiative tracker, HP management, dice roller, and loot tables.</div>
                </div>
            </a>

            <a href="dm-screen.html" class="dm-only">
                <div class="card tools-card-danger">
                    <div class="icon">üìΩÔ∏è</div>
                    <div class="title">Narrative Screen</div>
                    <div class="desc">Street scenes, atmospheric texture, NPC quirks, and quick references.</div>
                </div>
            </a>

            <a href="clue.html" class="dm-only">
                <div class="card tools-card-danger">
                    <div class="icon">üîç</div>
                    <div class="title">Clue Generator</div>
                    <div class="desc">Procedural mystery intersection generator (Signal vs Noise).</div>
                </div>
            </a>

            <a href="encounters.html" class="dm-only">
                <div class="card tools-card-danger">
                    <div class="icon">‚öôÔ∏è</div>
                    <div class="title">Encounter Recipes</div>
                    <div class="desc">Prep custom enemy packages, hazards, and rewards.</div>
                </div>
            </a>

        </div>
    </div>
    <script src="js/data-guilds.js"></script>
    <script src="js/data-npcs.js"></script>
    <script src="js/data-locations.js"></script>
    <script src="js/store.js"></script>
    <script src="js/vector-field.js"></script>
    <script src="js/tools.js"></script>
</body>

</html>
